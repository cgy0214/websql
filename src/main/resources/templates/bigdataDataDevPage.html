<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>数据开发</title>
    <link rel="shortcut icon" type="image/x-icon" th:href="@{/static/img/favicon.ico}" media="screen"/>
    <link rel="stylesheet" th:href="@{/static/css/layui.css}" media="all"/>
</head>
<body>
<div class="layui-card-header"
     style="font-size: 15px; color: #999; font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
    枢易方舟 - 数据开发
</div>
<hr class="layui-border-green">
<div class="layui-field-box">
    <form class="layui-form" action="" id="dataDevForm">
        <div class="layui-form-item">
            <label class="layui-form-label">任务名称</label>
            <div class="layui-input-inline" style="width: 40%;">
                <input type="text" name="taskName" id="taskName" lay-verify="required" autocomplete="off" lay-affix="clear"
                       placeholder="请输入任务名称" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">任务类型</label>
            <div class="layui-input-inline" style="width: 40%;">
                <select name="taskType" id="taskType" lay-verify="required">
                    <option value="">请选择任务类型</option>
                    <option value="SQL">SQL任务</option>
                    <option value="ETL">ETL任务</option>
                    <option value="PYTHON">Python任务</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">任务编码</label>
            <div class="layui-input-inline" style="width: 40%;">
                <input type="text" name="taskCode" id="taskCode" autocomplete="off" lay-affix="clear"
                       placeholder="请输入任务编码" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">数据源</label>
            <div class="layui-input-inline" style="width: 40%;">
                <select name="dataSource" id="dataSource" lay-verify="required">
                    <option value="">请选择数据源</option>
                    <option value="mysql">mysql</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">任务描述</label>
            <div class="layui-input-block" style="width: 80%;">
                <textarea name="description" id="description" placeholder="请输入任务描述" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">SQL内容</label>
            <div class="layui-input-block" style="width: 80%;">
                <textarea name="sqlContent" id="sqlContent" placeholder="请输入SQL内容" class="layui-textarea" style="height: 300px;"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">任务状态</label>
            <div class="layui-input-inline" style="width: 40%;">
                <select name="status" id="status">
                    <option value="草稿">草稿</option>
                    <option value="启用">启用</option>
                    <option value="停用">停用</option>
                </select>
            </div>
        </div>

        <div class="page-footer">
            <div class="btn-list">
                <div class="btnlist">
                    <button class="layui-btn layui-btn-primary layui-border-green layui-btn-sm" lay-submit
                            lay-filter="save">
                        <i class="layui-icon layui-icon-ok">&nbsp;</i>保存
                    </button>
                    <button class="layui-btn layui-btn-primary layui-border-blue layui-btn-sm" lay-submit
                            lay-filter="saveAndExecute">
                        <i class="layui-icon layui-icon-play">&nbsp;</i>保存并执行
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>
<script th:src="@{/static/layui.js}"></script>
<script th:src="@{/static/lay-config.js}"></script>
<script th:replace="~{base::ctx}"></script>
<script>
    layui.use(['layer', 'form'], function () {
        const layer = layui.layer;
        const form = layui.form;

        form.on('submit(save)', function (data) {
            const field = data.field;
            post(ctx + "bigdataManager/saveTask", field, (res) => {
                layer.alert(res.msg, {icon: res.code === 200 ? 1 : 2});
            })
            return false;
        });

        form.on('submit(saveAndExecute)', function (data) {
            const field = data.field;
            post(ctx + "bigdataManager/saveTask", field, (res) => {
                if (res.code === 200) {
                    layer.msg('保存成功，准备执行任务', {icon: 1});
                } else {
                    layer.alert(res(res.msg, {icon: 2}));
                }
            })
            return false;
        });
    });
</script>
</body>
</html>
