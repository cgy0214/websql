<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>WebSql-AI智能助手</title>
    <link rel="shortcut icon" type="image/x-icon" th:href="@{/static/img/favicon.ico}" media="screen"/>
    <link rel="stylesheet" th:href="@{/static/css/layui.css}" media="all"/>
</head>
<body>
<div class="layui-container" style="margin-top: 20px;">
    <div class="copilot-container">
        <div class="copilot-header">
            <img th:src="@{/static/img/copilot.png}" alt="Copilot Icon" class="copilot-icon">
            <h1>DMS Data Copilot</h1>
            <p>Copilot由 AI 提供支持,因此可能会存在错误</p>
            <p>请在使用前仔细查看输出内容</p>
        </div>
        <div class="copilot-suggestions">
            <div class="suggestion-card">
                <p>按零售店和产品汇总出库数量和金额</p>
            </div>
            <div class="suggestion-card">
                <p>查询指定零售代码和产品代码的库存明细</p>
            </div>
            <div class="suggestion-card">
                <p>查询当前表使用的时区</p>
            </div>
            <div class="suggestion-card">
                <p>怎么写窗口函数</p>
            </div>
        </div>
        <div class="copilot-chat-area">
            <div id="chat-history"></div>
            <div class="chat-input">
                <textarea id="question" placeholder="请问我任意问题..."></textarea>
                <button type="button" class="layui-btn" onclick="ask()">发送</button>
            </div>
        </div>
        <div class="copilot-footer">
            <p>服务生成的所有内容均由人工智能模型生成,其生成内容的准确性和完整性无法保证,不代表我们的态度或观点</p>
        </div>
    </div>
</div>
<script th:src="@{/static/layui.js}"></script>
<script th:src="@{/static/base64.min.js}"></script>
<script th:replace="~{base::ctx}"/>
<script>

    layui.use(function () {
        const layer = layui.layer;
        const form = layui.form;
        const $ = layui.jquery;
        const table = layui.table;
        const laytpl = layui.laytpl;
        const util = layui.util;

        layui.code({
            elem: '.code-sql'
        });

        $('.suggestion-card').on('click', function() {
            const suggestionText = $(this).find('p').text();
            $('#question').val(suggestionText);
        });

    });

    function ask() {
        const q = document.getElementById('question').value.trim();
        if (!q) return layui.layer.msg('请输入问题');
        const answerDom = document.getElementById('chat-history');
        answerDom.innerHTML += '<p><strong>You:</strong> ' + q + '</p>';
        answerDom.innerHTML += '<p><strong>AI:</strong> 正在思考中...</p>';


        let content = '/aiManager/stream?text=' + encodeURIComponent(q);
        const source = new EventSource(content);
        let aiAnswer = '';

        source.onmessage = e => {
            aiAnswer += e.data;
            const aiMessages = answerDom.querySelectorAll('p > strong');
            const lastAiMessage = aiMessages[aiMessages.length - 1].parentElement;
            lastAiMessage.innerHTML = '<strong>AI:</strong> ' + aiAnswer;
        };
        source.onerror = function () {
            source.close();
            layui.layer.msg('回答完毕');
        };
    }
</script>
<style>
    .copilot-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    .copilot-header {
        text-align: center;
        margin-bottom: 40px;
    }
    .copilot-icon {
        width: 60px;
        height: 60px;
    }
    .copilot-header h1 {
        font-size: 28px;
        margin: 10px 0;
    }
    .copilot-header p {
        color: #666;
    }
    .copilot-suggestions {
        display: flex;
        justify-content: space-around;
        margin-bottom: 40px;
    }
    .suggestion-card {
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 20px;
        width: 45%;
        text-align: center;
        cursor: pointer;
        transition: box-shadow 0.3s;
    }
    .suggestion-card:hover {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .copilot-chat-area {
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }
    #chat-history {
        min-height: 200px;
        margin-bottom: 20px;
    }
    .chat-input {
        display: flex;
    }
    .chat-input textarea {
        flex-grow: 1;
        border-radius: 4px;
        border: 1px solid #ccc;
        padding: 10px;
    }
    .chat-input button {
        margin-left: 10px;
    }
    .copilot-footer {
        text-align: center;
        color: #999;
        font-size: 12px;
    }
</style>
</body>
</html>